üì¶ Sausage Store Analytics (PostgreSQL + Flyway + CI/CD)

‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É, –º–æ–¥–µ–ª–∏—Ä—É—é—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ —Å–æ—Å–∏—Å–æ–∫. –û–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç:

- –º–∏–≥—Ä–∞—Ü–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É PostgreSQL —á–µ—Ä–µ–∑ Flyway;

- –º–∞—Å—Å–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö (10 –º–ª–Ω –∑–∞–∫–∞–∑–æ–≤ –∏ —Å–≤—è–∑–µ–π);

- –∑–∞–ø—É—Å–∫ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ —Å –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ GitHub Actions;

- –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Å—á—ë—Ç –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö —Å–æ—Å–∏—Å–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π).

üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç	–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è
–Ø–∑—ã–∫ –ë–î	PostgreSQL 16
–ú–∏–≥—Ä–∞—Ü–∏–∏	Flyway 9.22
CI/CD	GitHub Actions
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è	Docker Compose
–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö	Volume –≤ Docker
–¢–µ—Å—Ç—ã	Binary-–∞–≤—Ç–æ—Ç–µ—Å—Ç—ã (dbopstest)

‚öôÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

.
‚îú‚îÄ‚îÄ .github/workflows/main.yml        # CI-–ø–∞–π–ø–ª–∞–π–Ω
‚îú‚îÄ‚îÄ docker-compose.yml                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ PostgreSQL
‚îú‚îÄ‚îÄ insert-data.sh                    # Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ V001__create_tables.sql       # –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îú‚îÄ‚îÄ V002__change_schema.sql       # –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ö–µ–º—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ V003__insert_data.sql         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ V004__create_index.sql        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Readme.md                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

git clone <this-repo>
cd <this-repo>

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL —á–µ—Ä–µ–∑ Docker Compose

docker-compose up -d

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Flyway


flyway -url=jdbc:postgresql://localhost:5432/store \
       -user=user -password=password \
       -locations=filesystem:migrations migrate

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flyway —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ë–î

psql -U user -d store -h localhost -c '\dt'

ü§ñ CI/CD –ø–∞–π–ø–ª–∞–π–Ω

–§–∞–π–ª .github/workflows/main.yml –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç:

- PostgreSQL –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ;

- —É—Å—Ç–∞–Ω–æ–≤–∫—É Flyway –∏ –ø—Ä–æ–≥–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π;

- —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ (dbopstest);

- –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î.

–ü–∞–π–ø–ª–∞–π–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—É—à–µ –≤ main.

üß™ SQL-–∑–∞–ø—Ä–æ—Å (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞: —Å–∫–æ–ª—å–∫–æ —Å–æ—Å–∏—Å–æ–∫ –±—ã–ª–æ –ø—Ä–æ–¥–∞–Ω–æ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏:

SELECT
  o.date_created,
  SUM(op.quantity) AS total_sold
FROM
  orders AS o
JOIN
  order_product AS op ON o.id = op.order_id
WHERE
  o.status = 'shipped'
  AND o.date_created > NOW() - INTERVAL '7 DAY'
GROUP BY
  o.date_created
ORDER BY
  o.date_created;


üìå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º

V001__create_tables.sql: –±–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã product, orders, order_product.

V002__change_schema.sql: —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π price, date_created, –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏.

V003__insert_data.sql: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ 10M –∑–∞–ø–∏—Å–µ–π —Å generate_series –∏ random().

V004__create_index.sql: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ order_id, status, date_created –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

üìë –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: insert-data.sh

–°–∫—Ä–∏–ø—Ç insert-data.sh –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Å—é —Å—Ö–µ–º—É –≤—Ä—É—á–Ω—É—é;

- –Ω–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Flyway;

- —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–µ–±–∞–≥–∞.

üì© –ê–≤—Ç–æ—Ä

–û—Ä–¥—É—Ö–∞–Ω–∏ –†–∏–∑–∞
‚úâÔ∏è orduhaniriza@gmail.com